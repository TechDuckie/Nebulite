name: Deploy Nebulite to itch.io

on:
  release:
    types: [published]

env:
  ITCH_USERNAME: Badankan
  ITCH_GAME_ID: nebulite

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        channel:
          - web   # Only HTML5/web build for now

    steps:
      # Step 1: Checkout repo
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Zip the game files
      - name: Create web build ZIP
        run: |
          mkdir -p build/web
          zip -r build/web/nebulite.zip . -x ".git/*" -x ".github/*"

      # Step 3: Upload ZIP to itch.io using KikimoraGames/itch-publish
      - name: Upload to itch.io
        uses: KikimoraGames/itch-publish@v0.0.3
        with:
          butlerApiKey: ${{ secrets.ITCH_IO_API_KEY }}
          gameData: ./build/${{ matrix.channel }}/nebulite.zip
          itchUsername: ${{ env.ITCH_USERNAME }}
          itchGameId: ${{ env.ITCH_GAME_ID }}
          buildChannel: ${{ matrix.channel }}
          buildNumber: ${{ github.run_id }}
